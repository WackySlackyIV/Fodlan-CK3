namespace = FOD_alliance

FOD_alliance.1 = {
	type = character_event
	title = FOD_alliance.1.t
	desc = FOD_alliance.1.desc
	theme = realm
	left_portrait = root
	right_portrait = liege
	
	immediate = {
		liege = {
			random_character_war = { save_scope_as = liege_war }
			save_scope_as = liege_desc
		}
	}
	
	option = {
		name = "FOD_alliance.1.a" #help as defender
		trigger = { 
			liege = {
				is_defender_in_war = scope:liege_war
			}
		}
		scope:liege_war = { add_defender = PREV }
		
		ai_chance = {
			base = 10
			
			modifier = {
				add = 100
				liege = { has_relation_friend = PREV }
			}
			
			modifier = {
				add = 20
				is_close_family_of = liege
			}
			
			modifier = {
				add = {
					value = liege.dread
					multiply = 0.5
				}
			}
			
			modifier = {
				add = 20
				opinion = {
					target = liege
					value >= 50
				}
			}
		}
	}

	option = {
		name = "FOD_alliance.1.a" #help as attacker
		trigger = { 
			liege = {
				is_attacker_in_war = scope:liege_war
			}
		}
		scope:liege_war = { add_attacker = PREV }
		
		ai_chance = {
			base = 0
			
			modifier = {
				add = 100
				liege = { has_relation_friend = PREV }
			}
			
			modifier = {
				add = 20
				is_close_family_of = liege
			}
			
			modifier = {
				add = {
					value = liege.dread
					multiply = 0.5
				}
			}
			
			modifier = {
				add = 20
				opinion = {
					target = liege
					value >= 50
				}
			}
			
			modifier = {
				add = 10
				OR = {
					has_trait = brave
					has_trait = wrathful
					has_trait = just
					has_trait = education_martial
				}
			}
		}
	}
	
	option = {
		name = "FOD_alliance.1.b" #refuse to help
		
		ai_chance = {
			base = 10
			
			modifier = {
				add = 10
				liege = { is_at_war_as_attacker = yes }
			}
			
			modifier = {
				add = 10
				OR = {
					has_trait = lazy
					has_trait = craven
					has_trait = shy
					has_trait = arbitrary
					has_trait = depressed_1
					has_trait = depressed_genetic
					has_trait = maimed
					has_trait = infirm
					has_trait = incapable
					has_trait = blind
				}
			}
			
			modifier = {
				add = 100
				liege = { has_relation_rival = PREV }
			}
			
			modifier = {
				add = 20
				opinion = {
					target = liege
					value <= 0
				}
			}
		}
	}
}

FOD_alliance.2 = { #Hooks for fame event
	type = character_event
	title = FOD_alliance.2.t
	desc = {
		desc = FOD_alliance.2.desc.opening
		first_valid = {
			triggered_desc = {
				limit = { has_usable_hook = scope:great_lord }
				desc = FOD_alliance.2.desc.hook
			}
			desc = FOD_alliance.2.desc.no_hook
		}
	}
	theme = vassal
	left_portrait = root
	right_portrait = scope:great_lord
	
	trigger = {
		has_government = alliance_government
		is_available_adult = yes
		title:k_leicester = {
			any_elector = {
				NOR = {
					has_hook = root
					this = root
					has_opinion_modifier = {
						target = root
						modifier = disappointed_opinion
					}
				}
				is_available_adult = yes
			}
		}
	}
	
	immediate = {
		title:k_leicester = {
			random_elector = {
				limit = {
					NOR = {
						has_hook = root
						this = root
						has_opinion_modifier = {
							target = root
							modifier = disappointed_opinion
						}
					}
					is_available_adult = yes
				}
				save_scope_as = great_lord
			}
		}
	}
	
	option = { #Give hook, gain fame
		name = FOD_alliance.2.a
		trigger = {
			scope:great_lord = {
				can_add_hook = {
					target = root
					type = favor_hook
				}
			}
		}
		scope:great_lord = {
			add_hook = {
				target = root
				type = favor_hook
			}
		}
		gain_alliance_fame_effect = root
		ai_chance = {
			base = 50
			opinion_modifier = {
				opinion_target = scope:great_lord
				multiplier = 2
			}
			modifier = {
				factor = 0
				has_usable_hook = scope:great_lord
			}
		}
	}
	
	option = { #Use hook, gain fame
		name = FOD_alliance.2.b
		trigger = {
			has_usable_hook = scope:great_lord
		}
		use_hook = scope:great_lord
		gain_alliance_fame_effect = root
		ai_chance = {
			base = 50
		}
	}
	
	option = { #Refuse
		name = FOD_alliance.2.c
		reverse_add_opinion = {
			target = scope:great_lord
			modifier = disappointed_opinion
			opinion = -20
		}
		ai_chance = {
			base = 50
			modifier = {
				factor = 0
				has_usable_hook = scope:great_lord
			}
		}
	}
}